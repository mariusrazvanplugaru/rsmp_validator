<div>
  <div>Contexts</div>
  
    
    <div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
  </ul>
  
  <ul class='context-subcontext'>
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
  </ul>
  
  <ul class='context-subcontext'>
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
  </ul>
  
  <ul class='context-subcontext'>
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
         request_status_and_confirm site, "forced input status",
            { S0029: [:status] }
        end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|

          prepare task, site

          input = Validator.config['items']['force_input']

          # force input to false
          status = 'True'  # forced
          inputValue = 'False'
          force_input status:status, input:input, value:inputValue
          
          # verify forced = 1
          wait_for_status(@task,
            "input #{input} to be forced",
            [{'sCI'=>'S0029','n'=>'status','s'=>/^.{#{input - 1}}1/}]
          )

          # verify inputstatus = 0
          wait_for_status(@task,
            "input #{input} to be #{inputValue}",
            [{'sCI'=>'S0003','n'=>'inputstatus','s'=>/^.{#{input - 1}}0/}]
          )

          
          # force input to true
          status = 'True'  # forced
          inputValue = 'True'
          force_input status:status, input:input, value:inputValue
          
          # verify forced = 1
          wait_for_status(@task,
            "input #{input} to be forced",
            [{'sCI'=>'S0029','n'=>'status','s'=>/^.{#{input - 1}}1/}]
          )

          # verify inputstatus = 1
          wait_for_status(@task,
            "input #{input} to be to #{inputValue}",
            [{'sCI'=>'S0003','n'=>'inputstatus','s'=>/^.{#{input - 1}}1/}]
          )


          # release input
          status = 'False'  # unforced
          inputValue = 'False'
          force_input status:status, input:input, value:inputValue

          # verify force = 0
          wait_for_status(@task,
            "input #{input} to be released",
            [{'sCI'=>'S0029','n'=>'status','s'=>/^.{#{input - 1}}0/}]
          )

        end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>inputs = Validator.config['items']['inputs']
        skip("No inputs configured") if inputs.nil? || inputs.empty?
        Validator::Site.connected do |task,supervisor,site|
          prepare task, site
          inputs.each { |input| switch_input input }
        end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
          status = "3,4143,65;12,1,4"
          prepare task, site
          set_series_of_inputs status
        end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
          prepare task, site
          status = '1-50'
          set_trigger_level status
        end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
          prepare task, site
          wait_for_status(@task,
            "S0003 status",
            [{'sCI'=>'S0004','n'=>'outputstatus','s'=>/^[01]*/}]
          )
        end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
          request_status_and_confirm site, "forced output status",
            { S0030: [:status] }
        end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
          status = 'False'
          output = 1
          outputValue = 'True'
          prepare task, site
          force_output status, output, outputValue
        end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        alarm_code_id = 'A0302'
        prepare task, site
        def verify_timestamp alarm, duration=1.minute
          alarm_time = Time.parse(alarm.attributes["aTs"])
          expect(alarm_time).to be_within(duration).of Time.now.utc
        end
        deactivated, component_id = with_alarm_activated(task, site, alarm_code_id) do |alarm,component_id|   # raise alarm, by activating input
          verify_timestamp alarm
          log "Alarm #{alarm_code_id} is now Active on component #{component_id}"
        end
        verify_timestamp deactivated
        log "Alarm #{alarm_code_id} is now Inactive on component #{component_id}"
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        alarm_code_id = 'A0302'
        prepare task, site
        def verify_timestamp alarm, duration=1.minute
          alarm_time = Time.parse(alarm.attributes["aTs"])
          expect(alarm_time).to be_within(duration).of Time.now.utc
        end
        deactivate, component_id = with_alarm_activated(task, site, alarm_code_id) do |alarm,component_id|   # raise alarm, by activating input
          verify_timestamp alarm
          log "Alarm #{alarm_code_id} is now Active on component #{component_id}"
        end
        verify_timestamp deactivate
        log "Alarm #{alarm_code_id} is now Inactive on component #{component_id}"
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        alarm_code_id = 'A0302'   # what alarm to expect
        timeout  = Validator.config['timeouts']['alarm']

        log "Activating alarm #{alarm_code_id}"
        deactivate, component_id = with_alarm_activated(task, site, alarm_code_id) do |alarm, component_id|   # raise alarm, by activating input
          log "Alarm #{alarm_code_id} is now active on component #{component_id}"

          # verify timestamp
          alarm_time = Time.parse(alarm.attributes["aTs"])
          expect(alarm_time).to be_within(1.minute).of Time.now.utc

          # test acknowledge and confirm
          log "Acknowledge alarm #{alarm_code_id}"

          collect_task = task.async do
            RSMP::AlarmCollector.new(site,
              num: 1,
              query: {
                'aCId' => alarm_code_id,
                'aSp' => /Acknowledge/i,
                'ack' => /Acknowledged/i,
                'aS' => /Active/i
              },
              timeout: timeout
            ).collect!
          end

          site.send_message RSMP::AlarmAcknowledge.new(
            'cId' => component_id,
            'aTs' => site.clock.to_s,
            'aCId' => alarm_code_id
          )
          messages = collect_task.wait
          expect(messages).to be_an(Array)
          expect(messages.first).to be_a(RSMP::Alarm)
        end
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        alarm_code_id = 'A0302'
        action = Validator.config.dig('alarms', alarm_code_id)
        skip "alarm #{alarm_code_id} is not configured" unless action
        component_id = action['component']
        skip "alarm #{alarm_code_id} has no component configured" unless component_id
        # first resume to make sure something happens when we suspend
        resume = RSMP::AlarmResume.new(
          'cId' => component_id,
          'aCId' => alarm_code_id
        )
        site.send_message resume

        # now suspend the alarm while collecting responses
        suspend = RSMP::AlarmSuspend.new(
          'mId' => RSMP::Message.make_m_id,     # generate a message id, that can be used to listen for responses
          'cId' => component_id,
          'aCId' => alarm_code_id
        )
        collect_task = task.async do
          RSMP::AlarmCollector.new(site,
            m_id: suspend.m_id,
            num: 1,
            query: {
              'cId' => component_id,
              'aCI' => alarm_code_id,
              'aSp' => 'Suspend',
              'sS' => 'suspended'
            },
            timeout: Validator.config['timeouts']['alarm']
          ).collect!
        end

        begin
          site.send_message suspend
          messages = collect_task.wait
          expect(messages).to be_an(Array)
          message = messages.first
          expect(message).to be_a(RSMP::AlarmSuspended)
        rescue
          site.send_message resume    # clean up by resuming alarm
          raise
        end

        # clean up by resuming alarm
        resume.attributes['mId'] = RSMP::Message.make_m_id  # generate a message id, that can be used to listen for responses
        collect_task = task.async do
          RSMP::AlarmCollector.new(site,
            m_id: resume.m_id,
            num: 1,
            query: {'aCI'=>alarm_code_id,'aSp'=>'Suspend','sS'=>'notSuspended'},
            timeout: Validator.config['timeouts']['alarm']
          ).collect!
        end
        site.send_message resume
        messages = collect_task.wait
        expect(messages).to be_an(Array)
        message = messages.first
        expect(message).to be_a(RSMP::AlarmResumed)
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "current date and time",
          { S0096: [
            :year,
            :month,
            :day,
            :hour,
            :minute,
            :second,
          ] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        set_clock(CLOCK)
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        with_clock_set CLOCK do
          status_list = { S0096: [
            :year,
            :month,
            :day,
            :hour,
            :minute,
            :second,
          ] }
          result = site.request_status Validator.config['main_component'], convert_status_list(status_list), collect!: {
            timeout: Validator.config['timeouts']['status_update']
          }
          collector = result[:collector]
          status = status_list.keys.first.to_s

          received = Time.new(
            collector.query_result( {"sCI" => status, "n" => "year"} )['s'],
            collector.query_result( {"sCI" => status, "n" => "month"} )['s'],
            collector.query_result( {"sCI" => status, "n" => "day"} )['s'],
            collector.query_result( {"sCI" => status, "n" => "hour"} )['s'],
            collector.query_result( {"sCI" => status, "n" => "minute"} )['s'],
            collector.query_result( {"sCI" => status, "n" => "second"} )['s'],
            'UTC'
          )

          max_diff =
            Validator.config['timeouts']['command_response'] +
            Validator.config['timeouts']['status_response']

          diff = received - CLOCK
          diff = diff.round
          expect(diff.abs).to be <= max_diff,
            "Clock reported by S0096 is off by #{diff}s, should be within #{max_diff}s"
        end
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        with_clock_set CLOCK do
          status_list = { S0096: [
            :year,
            :month,
            :day,
            :hour,
            :minute,
            :second,
          ] }
          
          result = site.request_status Validator.config['main_component'],
            convert_status_list(status_list),
            collect!: {
              timeout: Validator.config['timeouts']['status_response']
            }
          collector = result[:collector]

          max_diff = Validator.config['timeouts']['command_response'] + Validator.config['timeouts']['status_response']
          diff = Time.parse(collector.messages.first.attributes['sTs']) - CLOCK
          diff = diff.round
          expect(diff.abs).to be <= max_diff,
            "Timestamp of S0096 is off by #{diff}s, should be within #{max_diff}s"
        end
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        with_clock_set CLOCK do
          result = site.request_aggregated_status Validator.config['main_component'], collect!: {
            timeout: Validator.config['timeouts']['status_response']
          }
          collector = result[:collector]
          max_diff = Validator.config['timeouts']['command_response'] + Validator.config['timeouts']['status_response']
          diff = Time.parse(collector.messages.first.attributes['aSTS']) - CLOCK
          diff = diff.round
          expect(diff.abs).to be <= max_diff,
            "Timestamp of aggregated status is off by #{diff}s, should be within #{max_diff}s"
        end
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        with_clock_set CLOCK do
          result = set_functional_position 'NormalControl'
          collector = result[:collector]
          max_diff = Validator.config['timeouts']['command_response'] * 2
          diff = Time.parse(collector.messages.first.attributes['cTS']) - CLOCK
          diff = diff.round
          expect(diff.abs).to be <= max_diff,
            "Timestamp of command response is off by #{diff}s, should be within #{max_diff}s"
        end
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        with_clock_set CLOCK do
          result = set_functional_position 'NormalControl'
          collector = result[:collector]
          max_diff = Validator.config['timeouts']['command_response']
          diff = Time.parse(collector.messages.first.attributes['cTS']) - CLOCK
          diff = diff.round
          expect(diff.abs).to be <= max_diff,
            "Timestamp of command response is off by #{diff}s, should be within #{max_diff}s"
        end
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        with_clock_set CLOCK do                           # set clock
          with_alarm_activated(task, site, 'A0302') do |alarm|   # raise alarm, by activating input
            alarm_time = Time.parse( alarm.attributes["aTs"] )
            max_diff = Validator.config['timeouts']['command_response'] + Validator.config['timeouts']['status_response']
            diff = alarm_time - CLOCK
            expect(diff.round.abs).to be <= max_diff,
              "Timestamp of alarm is off by #{diff}s, should be within #{max_diff}s"
          end
        end
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        with_clock_set CLOCK do
          log "Checking watchdog timestamp"
          collector = RSMP::Collector.new site, task:task, type: "Watchdog", num: 1, timeout: Validator.config['timeouts']['watchdog']
          collector.collect!
          max_diff = Validator.config['timeouts']['command_response'] + Validator.config['timeouts']['status_response']
          diff = Time.parse(collector.messages.first.attributes['wTs']) - CLOCK
          diff = diff.round
          expect(diff.abs).to be <= max_diff,
            "Timestamp of watchdog is off by #{diff}s, should be within #{max_diff}s"
        end
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "control mode",
          { S0020: [:controlmode,:intersection] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "traffic controller starting (true/false)",
          { S0005: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "emergency stage status",
          { S0006: [:status,:emergencystage] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0007: [:status,:intersection,:source] }
        else
          status_list = { S0007: [:status,:intersection] }
        end
        request_status_and_confirm site, "controller switch on (dark mode=off)", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0008: [:status,:intersection,:source] }
        else
          status_list = { S0008: [:status,:intersection] }
        end
        request_status_and_confirm site, "manual control status", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0009: [:status,:intersection,:source] }
        else
          status_list = { S0009: [:status,:intersection] }
        end
        request_status_and_confirm site, "fixed time control status", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        switch_fixed_time 'True'
        switch_fixed_time 'False'
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0010: [:status,:intersection,:source] }
        else
          status_list = { S0010: [:status,:intersection] }
        end
        request_status_and_confirm site, "isolated control status", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        status_list = { S0032: [:status,:intersection,:source] }
        request_status_and_confirm site, "coordinated control status", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0011: [:status,:intersection,:source] }
        else
          status_list = { S0011: [:status,:intersection] }
        end
        request_status_and_confirm site, "yellow flash status", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        switch_yellow_flash
        switch_normal_control
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        timeout =  10

        switch_yellow_flash
        wait_for_groups 'c', timeout: timeout      # c mean s yellow flash

        switch_normal_control
        wait_for_groups '[^c]', timeout: timeout   # not c, ie. not yellow flash
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0012: [:status,:intersection,:source] }
        else
          status_list = { S0012: [:status,:intersection] }
        end
        request_status_and_confirm site, "all-red status", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "police key",
          { S0013: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        switch_dark_mode
        switch_normal_control
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        switch_normal_control
        minutes = 1
        switch_yellow_flash timeout_minutes: minutes
        wait_normal_control timeout: minutes*60 + Validator.config['timeouts']['functional_position']
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0091: [:user] }
        else
          status_list = { S0091: [:user, :status] }
        end
        request_status_and_confirm site, "operator logged in/out OP-panel", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0092: [:user] }
        else
          status_list = { S0092: [:user, :status] }
        end
        request_status_and_confirm site, "operator logged in/out web-interface", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "version of traffic controller",
        { S0095: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.isolated do |task,supervisor,site|
        prepare task, site
        supervisor.ignore_errors RSMP::DisconnectError do
          set_restart
          site.wait_for_state :disconnected, timeout: Validator.config['timeouts']['shutdown']
        end
      end

      # NOTE
      # when a remote site closes the connection, our site proxy object will stop.
      # when the site reconnects, a new site proxy object will be created.
      # this means we can't wait for the old site to become ready
      # it also means we need a new Validator::Site.
      Validator::Site.isolated do |task,supervisor,site|
        prepare task, site
        site.wait_for_state :ready, timeout: Validator.config['timeouts']['ready']
        wait_normal_control
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        set_security_code 1
        set_security_code 2
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        expect { wrong_security_code }.to raise_error(RSMP::MessageRejected)
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        log "Subscribe to status and wait for update"
        component = Validator.config['main_component']

        status_list = [{'sCI'=>'S0001','n'=>'signalgroupstatus','uRt'=>'1'}]
        status_list.map! { |item| item.merge!('sOc' => 'False') } if use_sOc?(site)

         site.subscribe_to_status component, status_list, collect!: {
          timeout: Validator.config['timeouts']['status_update']
        }
      ensure
        unsubscribe_list = status_list.map { |item| item.slice('sCI','n') }
        site.unsubscribe_to_status component, unsubscribe_list
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0014: [:status,:source] }
        else
          status_list = { S0014: [:status] }
        end
        request_status_and_confirm site, "current time plan", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>plans = Validator.config['items']['plans']
      skip("No time plans configured") if plans.nil? || plans.empty?
      Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        plans.each { |plan| switch_plan plan }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "number of time plans",
          { S0018: [:number] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "list of time plans",
          { S0022: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "week time table",
          { S0026: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        status = "0-1,6-2"
        prepare task, site
        set_week_table status
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "command table",
          { S0027: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        status = "12-1-12-59,1-0-23-12"
        prepare task, site
        set_day_table status
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "version of traffic program",
          { S0097: [:timestamp,:checksum] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        status = 5
        plan = 0
        prepare task, site
        set_cycle_time status, plan
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "command table",
          { S0023: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        plan = "1"
        status = "1-12"
        prepare task, site
        set_dynamic_bands plan, status
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        plan = 1
        band = 3

        value = get_dynamic_bands(plan, band) || 0
        expect( value ).to be_a(Integer)

        new_value = value + 1
        
        set_dynamic_bands plan, "#{band}-#{new_value}"
        expect( get_dynamic_bands(plan, band) ).to eq(new_value)

        set_dynamic_bands plan, "#{band}-#{value}"
        expect( get_dynamic_bands(plan, band) ).to eq(value)
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        status = 10
        set_timeout_for_dynamic_bands status
        status = 0
        set_timeout_for_dynamic_bands status
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "offset time",
          { S0024: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        plan = 1
        status = 99
        prepare task, site
        set_offset status, plan
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "cycle time",
          { S0028: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        status = 5
        plan = 0
        prepare task, site
        set_cycle_time status, plan
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "traffic counting: number of vehicles",
          { S0201: [:starttime,:vehicles] },
          Validator.config['components']['detector_logic'].keys.first
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "traffic counting: number of vehicles",
          { S0205: [:start,:vehicles] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "traffic counting: vehicle speed",
          { S0202: [:starttime,:speed] },
          Validator.config['components']['detector_logic'].keys.first
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "traffic counting: vehicle speed",
          { S0206: [:start,:speed] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "traffic counting: occupancy",
          { S0203: [:starttime,:occupancy] },
          Validator.config['components']['detector_logic'].keys.first
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "traffic counting: occupancy",
          { S0207: [:start,:occupancy] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "traffic counting: classification",
          { S0204: [
              :starttime,
              :P,
              :PS,
              :L,
              :LS,
              :B,
              :SP,
              :MC,
              :C,
              :F
          ] },
          Validator.config['components']['detector_logic'].keys.first
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "traffic counting: classification",
          { S0208: [
              :start,
              :P,
              :PS,
              :L,
              :LS,
              :B,
              :SP,
              :MC,
              :C,
              :F
          ] }
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        set_signal_start
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        set_signal_stop
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "signal group status",
          { S0001: [:signalgroupstatus, :cyclecounter, :basecyclecounter, :stage] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "time-of-green/time-of-red",
          { S0025: [
              :minToGEstimate,
              :maxToGEstimate,
              :likelyToGEstimate,
              :ToGConfidence,
              :minToREstimate,
              :maxToREstimate,
              :likelyToREstimate
          ] },
          Validator.config['components']['signal_group'].keys.first
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        set_signal_start_or_stop '5,4134,65;5,11'
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "number of signal groups",
          { S0017: [:number] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        supervisor.ignore_errors RSMP::DisconnectError do
          verify_startup_sequence do
            set_restart
            site.wait_for_state :disconnected, timeout: Validator.config['timeouts']['shutdown']
            site.wait_for_state :ready, timeout: Validator.config['timeouts']['ready']
          end
        end
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        verify_startup_sequence do
          switch_yellow_flash
          set_functional_position 'NormalControl'
        end
        set_functional_position 'NormalControl'
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "number of detector logics",
          { S0016: [:number] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "detector logic status",
          { S0002: [:detectorlogicstatus] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "detector logic forcing",
          { S0021: [:detectorlogics] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site

        Validator.config['components']['detector_logic'].keys.each_with_index do |component, indx|
          force_detector_logic component, mode:'True'
          Validator.config['main_component'] = Validator.config['main_component']
          wait_for_status(@task,
            "detector logic #{component} to be True",
            [{'sCI'=>'S0002','n'=>'detectorlogicstatus','s'=>/^.{#{indx}}1/}]
          )
          
          force_detector_logic component, mode:'False'
          Validator.config['main_component'] = Validator.config['main_component']
          wait_for_status(@task,
            "detector logic #{component} to be False",
            [{'sCI'=>'S0002','n'=>'detectorlogicstatus','s'=>/^.{#{indx}}0/}]
          )
        end
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "loop detector sensitivity",
          { S0031: [:status] }
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        signal_group = Validator.config['components']['signal_group'].keys.first
        command_list = build_command_list :M0022, :requestPriority, {
          requestId: SecureRandom.uuid()[0..3],
          signalGroupId: signal_group,
          type: 'new',
          level: 7,
          eta: 10,
          vehicleType: 'car'
        }
        prepare task, site
        send_command_and_confirm @task, command_list,
          "Request signal priority for signal group #{signal_group}"
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "signal group status",
          { S0033: [:status] }
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        status_list = [{'sCI'=>'S0033','n'=>'status','uRt'=>'0'}]
        status_list.map! { |item| item.merge!('sOc' => 'True') } if use_sOc?(site)
        wait_for_status task, 'signal priority status', status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        sequence = ['received','activated','completed']
        # subscribe
        component = Validator.config['main_component']
        log "Subscribing to signal priority request status updates"
        status_list = [{'sCI'=>'S0033','n'=>'status','uRt'=>'0'}]
        status_list.map! { |item| item.merge!('sOc' => 'True') } if use_sOc?(site)
        site.subscribe_to_status component, status_list

        # start collector
        request_id = SecureRandom.uuid()[0..3]    # make a message id
        num = sequence.length
        states = []
        result = nil
        collector = nil
        collect_task = task.async do
          collector = RSMP::Collector.new(
            site,
            type: "StatusUpdate",
            num: num,
            timeout: Validator.config['timeouts']['priority_completion'],
            component: component
          )

          def search_for_request_state request_id, message, states
            message.attribute('sS').each do |status|
              return nil unless status['sCI'] == 'S0033' && status['n'] == 'status'
              status['s'].each do |priority|
                next unless priority['r'] == request_id  # is this our request
                state = priority['s']
                next unless state != states.last  # did the state change?
                log "Priority request reached state '#{state}'"
                return state
              end
            end
            nil
          end

          result = collector.collect do |message|
            state = search_for_request_state request_id, message, states
            next unless state
            states << state
            :keep
          end
        end

        def send_priority_request log, id:nil, site:, component:
          # send an unrelated request before our request, to check that it does not interfere
          log log
          signal_group = Validator.config['components']['signal_group'].keys.first
          command_list = build_command_list :M0022, :requestPriority, {
            requestId: (id || SecureRandom.uuid()[0..3]),
            signalGroupId: signal_group,
            type: 'new',
            level: 7,
            eta: 2,
            vehicleType: 'car'
          }
          site.send_command component, command_list
        end

        send_priority_request "Send an unrelated signal priority request before",
          site: site, component: component
        send_priority_request "Send our signal priority request",
          site: site, component: component, id: request_id
        send_priority_request "Send an unrelated signal priority request after",
          site: site, component: component

        # wait for collector to complete and check result
        collect_task.wait
        expect(result).to eq(:ok)
        expect(collector.messages).to be_an(Array)
        expect(collector.messages.size).to eq(num)
        expect(states).to eq(sequence), "Expected state sequence #{sequence}, got #{states}"
      ensure
        # unsubcribe
        unsubscribe_list = status_list.map { |item| item.slice('sCI','n') }
        site.unsubscribe_to_status component, unsubscribe_list
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>emergency_routes = Validator.config['items']['emergency_routes']
      skip("No emergency routes configured") if emergency_routes.nil? || emergency_routes.empty?
      Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        emergency_routes.each { |emergency_route| switch_emergency_route emergency_route.to_s }
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        if RSMP::Proxy.version_meets_requirement?( site.sxl_version, '>=1.1' )
          status_list = { S0015: [:status,:source] }
        else
          status_list = { S0015: [:status] }
        end
        request_status_and_confirm site, "current traffic situation", status_list
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>situations = Validator.config['items']['traffic_situations']
      skip("No traffic situations configured") if situations.nil? || situations.empty?
      Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        situations.each { |traffic_situation| switch_traffic_situation traffic_situation.to_s }
      ensure
        unset_traffic_situation
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        request_status_and_confirm site, "number of traffic situations",
          { S0019: [:number] }
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
  </ul>
  
  <ul class='context-subcontext'>
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.1'</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.2'</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.3'</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.4'</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.5'</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.2'</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>timeout = Validator.config['timeouts']['disconnect']
      Validator::Site.isolated do |task,supervisor,site_proxy|
        supervisor.ignore_errors RSMP::DisconnectError do
          log "Disabling watchdog acknowledgements, site should disconnect"
          def site_proxy.acknowledge original
            if original.is_a? RSMP::Watchdog
              log "Not acknowledgning watchdog", message: original
            else
              super
            end
          end
          site_proxy.wait_for_state :disconnected, timeout: timeout
        end
      rescue RSMP::TimeoutError
        raise "Site did not disconnect within #{timeout}s"
      end</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.isolated do |task,supervisor,site|
        timeout = Validator.config['timeouts']['disconnect']
        wait_task = task.async do
          site.wait_for_state :disconnected, timeout: timeout
          raise RSMP::DisconnectError
        rescue RSMP::TimeoutError
          # ok, no disconnect happened
        end

        log "Stop sending watchdogs, site should not disconnect"
        def site.send_watchdog now=nil
        end
        wait_task.wait
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Site.connected do |task,supervisor,site|
        prepare task, site
        log "Request aggregated status"
        result = site.request_aggregated_status Validator.config['main_component'], collect!: {
          timeout: Validator.config['timeouts']['status_response']
        }
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
  </ul>
</div></li>
    
    
    
  
  </ul>
</div>
  
    
    <div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
  </ul>
  
  <ul class='context-subcontext'>
  
    
    
    <li class='odd'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.1'</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.2'</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.3'</div> -->
</div></li>
      
      
    
      
      <li class='context-specification even'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.4'</div> -->
</div></li>
      
      
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>check_sequence '3.1.5'</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
    
    
    <li class='even'><div class='context'>
  <div class='title'></div>
  
  
  <ul class='context-specifications'>
    
      
      <li class='context-specification odd'><div>
  <div class="specification">
    
  </div>
  <!-- <div>Validator::Supervisor.connected do |task,site,supervisor_proxy|
        component = site.find_component Validator.config['main_component']

        # setting ':collect' will cause set_aggregated_status() to wait for the
        # outgoing aggregated status is acknowledged
        component.set_aggregated_status :high_priority_alarm, collect!: {
          timeout: Validator.config['timeouts']['acknowledgement'],
          num: 1
        }
      end</div> -->
</div></li>
      
      
    
  </ul>
  
  <ul class='context-subcontext'>
  
  </ul>
</div></li>
    
    
    
  
  </ul>
</div>
  
</div>